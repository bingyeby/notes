https://github.com/lcxfs1991/blog/issues/30
小程序·云开发的云函数路由高级玩法


### 云开发
需要具备的知识：
* 在开发工具的 左上角进入云开发控制台，可以查看数据库 用户管理 存储管理 云函数
* 进行云API的初始化： wx.cloud.init()
* 开发：数据库 存储 云函数

### 数据库
* 每个小程序帐号可免费创建两个环境
* 数据库存储空间2GB

数据库是json数据库： 数据库 - 集合 - doc/record -fild

数据库操作：
```js
// 1. 获取数据库引用
const db = wx.cloud.database()
// 2. 构造查询语句
// collection 方法获取一个集合的引用
// where 方法传入一个对象，数据库返回集合中字段等于指定值的 JSON 文档。API 也支持高级的查询条件（比如大于、小于、in 等），具体见文档查看支持列表
// get 方法会触发网络请求，往数据库取数据
db.collection('books').where({
  publishInfo: {
    country: 'United States'
  }
}).get({
  success(res) {
    console.log(res) // 输出 [{ "title": "The Catcher in the Rye", ... }]
  }
})
```

### 集合查询，本地最多返回20条
    需要通过云函数进行操作
        
### 小程序使用npm
    1. 使用npm小程序组件
        根目录执行(project.config.json miniprogramRoot)
        npm i vant-weapp -S --production
        在/pages/index/index.json 配置 
            {
              "usingComponents": {
                "van-button": "../../miniprogram_npm/vant-weapp/button/index"
              }
            }
        在xml中使用
            <van-button type="primary">按钮</van-button>

        
    2. 使用工具包 
      1. lodash 需要进行修改 
          http://blog.dongsj.cn/20180827-lodash-in-miniprogram.html
          var root = freeGlobal || freeSelf || Function('return this')();
          替换为
          var root =  {
            Array: Array,
            Date: Date,
            Error: Error,
            Function: Function,
            Math: Math,
            Object: Object,
            RegExp: RegExp,
            String: String,
            TypeError: TypeError,
            setTimeout: setTimeout,
            clearTimeout: clearTimeout,
            setInterval: setInterval,
            clearInterval: clearInterval
          };



### 小程序全局变量的实现方式
    global.util =util;//工具
    wx.api = api;//api








